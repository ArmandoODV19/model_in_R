---
title: "Series Temporales"
author: "Armando Ocampo"

output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Librerías de trabajo

Antes de comenzar a trabajar, debemos llamar a nuestras librerias de trabajo. Si no cuentas con alguna de estas librerias, puedes descargarla mediante la función *install.packages()*, y el nombre de la paquetería entre comillas. Por ejemplo, *install.packages('dplyr')*.

```{r librerias, echo=TRUE, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(ggpubr)
```

## Dataset de trabajo

De la misma manera, llamaremos a nuestro conjunto de datos a utilizar en el desarrollo del proyecto. Este dataset contiene información de diferentes variables asociadas con la pandemia de COVID-19, tomando solo información de México. Presenta un rango del 01 de enero del 2020 al 02 de agosto del 2023. Para más información, puedes acceder al sitio de descarga de los datos crudos, [**Our World in Data**](https://ourworldindata.org/covid-vaccinations).

```{r data, echo=TRUE}
covid_mexico <- readRDS('../data/covid_mexico.RDS')
```

Las series de tiempo de caracterizan por presentar información en un intervalo de tiempo definido. Este proceso permite comparar tendencias en los datos. Así como sitios de estancamiento. Para su exploración, es posible utilizar funciones como *min()*, *max()*, *length()* y *deltat()*. Esta última función arroja el intervalo de tiempo en días presente en el dataset.

```{r explorando, echo=TRUE}
min(covid_mexico$date)
max(covid_mexico$date)
length(covid_mexico$date)
1310/365  #3.5 años
deltat(covid_mexico$date) # intervalo de tiempo en días
```

Otra de las funciones que permiten describir el dataset es la función *diff()*, de la paquetería *base*. Esta función describe la diferencia de cada unidad con el valor previo en el rango de fechas establecidos.

```{r diferencia, echo=TRUE}
diferencia_casos <- diff(covid_mexico$total_cases) %>%
  na.omit()

head(diferencia_casos,20)
```

Mediante la función *ts()* de la paquetería *stats* es porible convertir esta diferencia en una serie de tiempo y graficar los valores dentro del periodo de tiempo marcado.

```{r dif2, echo=TRUE}
diferencia_ts <- ts(diferencia_casos)
plot(diferencia_ts)
```


```{r grafico, echo=TRUE, warning=FALSE, message=FALSE}
ggplot(covid_mexico, aes(x = date, y = total_cases)) +
  geom_line()
```


```{r grafico2, echo=TRUE, warning=FALSE, message=FALSE}
ggplot(covid_mexico, aes(x = date, y = total_cases)) +
  geom_line() +
  geom_smooth()
```



```{r grafico3, echo=TRUE, warning=FALSE, message=FALSE}
ggplot(covid_mexico, aes(x = date, y = total_cases)) +
  geom_line() +
  geom_smooth() +
  xlab('Fecha') +
  ylab('Casos Totales') +
  theme_bw()
```

scale_x_date() para darle formato a la fecha

%d: Day as a number between 0 and 31

%a: Abbreviated weekday (e.g. “Tue”)

%A: Unabbreviated weekday (e.g. “Tuesday”)

%m: Month between 0 and 12

%b: Abbreviated month (e.g. “Jan”)

%B: Unabbreviated month (e.g. “January”)

%y: 2-digit year (e.g. “21”)

%Y: 4-digit year (e.g. “2021”)

%W: Week of the year between 0 and 52


```{r grafico4, echo=TRUE, message=FALSE, warning=FALSE}
ggplot(covid_mexico, aes(x = date, y = total_cases)) +
  geom_line() +
  geom_smooth() +
  xlab('Fecha') +
  ylab('Casos Totales') +
  scale_x_date(date_labels = '%b %Y') +
  theme_bw()
```


```{r grafico5, echo=TRUE, warning=FALSE, message=FALSE}
ggplot(covid_mexico, aes(x = date, y = total_cases)) +
  geom_line() +
  geom_smooth() +
  xlab('Fecha') +
  ylab('Casos Totales') +
  theme_bw() +
  scale_x_date(date_labels = '%b %Y',
               date_breaks = '4 month') +
  theme(axis.text.x = element_text(angle = 90,
vjust = 0.5, hjust=1))
  
```


```{r filtrando, echo=TRUE}
min(covid_mexico$date)
max(covid_mexico$date)
```


```{r filtrando2, echo=TRUE, warning=FALSE, message=FALSE}
covid_mexico %>%
  filter(date >= '2021-01-01',
         date <= '2021-12-31')
```

```{r grafico6, echo=TRUE, message=FALSE, warning=FALSE}
covid_mexico %>%
  filter(date >= '2021-01-01',
         date <= '2021-12-31') %>%
  ggplot(aes(x = date, y = total_cases)) +
  geom_line() +
  scale_x_date(date_breaks = '1 month') +
  theme_bw()+
  theme(axis.text.x = element_text(angle = 90,
                                   vjust = 0.5, hjust=1))+
  xlab('Fecha') +
  ylab('Casos Totales')
```



```{r pegando, echo=TRUE, message=FALSE, warning=FALSE}
a <- covid_mexico %>%
  filter(date >= '2021-01-01',
         date <= '2021-12-31') %>%
  select(total_cases, date) %>%
  ggplot(aes(y = total_cases, x = date)) +
  geom_line() +
  geom_smooth() +
  theme(axis.text.x = element_text(angle = 90,
vjust = 0.5, hjust=1))

b <- covid_mexico %>%
  filter(date >= '2021-01-01',
         date <= '2021-12-31') %>%
  select(total_deaths, date) %>%
  ggplot(aes(y = total_deaths, x = date)) +
  geom_line() +
  geom_smooth()+
  theme(axis.text.x = element_text(angle = 90,
vjust = 0.5, hjust=1))

c <- covid_mexico %>%
  filter(date >= '2021-01-01',
         date <= '2021-12-31') %>%
  select(total_tests, date) %>%
  ggplot(aes(y = total_tests, x = date)) +
  geom_line() +
  geom_smooth()+
  theme(axis.text.x = element_text(angle = 90,
vjust = 0.5, hjust=1))
```


```{r pegando2, echo=TRUE, message=FALSE, warning=FALSE}
ggarrange(a, b, c,
          labels = c('CASOS', 'MUERTES', 'PRUEBAS'),
          ncol = 3, nrow = 1,
          font.label = list(size = 10),
          hjust = 0, vjust = 2.2)
```

















